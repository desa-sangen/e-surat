<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>E-SURAT DESA SANGEN v2 FINAL</title>
  <style>
    body {
      margin:0;
      font-family:Arial, sans-serif;
      background:#ffb347; /* oranye lembut */
    }
    header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:#ff8c00;
      color:white;
      padding:10px 20px;
    }
    header img {height:70px;}
    header h1 {
      flex:1;
      text-align:center;
      font-size:24px;
      text-shadow:1px 1px 2px #00000055;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo_kabupaten_magelang.png" alt="Kabupaten Magelang" />
    <h1>E-SURAT DESA SANGEN</h1>
    <img src="logo_provinsi_jawa_tengah.png" alt="Provinsi Jawa Tengah" />
  </header>

  <!-- nanti di bawah sini akan kita tempel semua script aplikasi -->
 <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
// ---------------------------
// E-SURAT DESA SANGEN v2  â€“  Bagian 1
// ---------------------------

// data utama
const LS_STATE = "esurat_sangen_v2_data";
let data = JSON.parse(localStorage.getItem(LS_STATE) || "{}");
if (!data.suratMasuk) data.suratMasuk = [];
if (!data.suratKeluar) data.suratKeluar = [];
if (!data.arsip) data.arsip = [];

// elemen utama
const app = document.createElement("div");
app.id = "app";
document.body.appendChild(app);

// render awal (halaman login)
renderLogin();


function renderLogin() {
  const app = document.getElementById("app");
  app.innerHTML = `
    <div style="padding:40px;text-align:center;color:white;">
      <h2 style="text-shadow:1px 1px 3px #000;">ğŸ” Login Admin</h2>
      <div style="margin-top:20px;">
        <input id="loginUser" type="text" placeholder="Username"
          style="padding:10px;width:220px;border-radius:6px;border:none;"><br><br>
        <input id="loginPass" type="password" placeholder="Password"
          style="padding:10px;width:220px;border-radius:6px;border:none;"><br><br>
        <button id="btnLogin"
          style="padding:8px 25px;border:none;border-radius:8px;background:#e67e22;color:white;font-weight:bold;cursor:pointer;">
          Masuk
        </button>
      </div>
    </div>
  `;

  const btn = document.getElementById("btnLogin");
  if (btn) {
    btn.addEventListener("click", () => {
      const u = document.getElementById("loginUser").value.trim();
      const p = document.getElementById("loginPass").value.trim();
      const saved = JSON.parse(localStorage.getItem("settings") || "{}");
      const username = saved.username || "admin";
      const password = saved.password || "1234";

      if (u === username && p === password) {
        localStorage.setItem("logged", "true");
        renderMenu();
      } else {
        alert("âŒ Username atau password salah!");
      }
    });
  }

  // biar bisa tekan Enter langsung login
  document.addEventListener("keypress", e => {
    if (e.key === "Enter") {
      const u = document.getElementById("loginUser");
      const p = document.getElementById("loginPass");
      if (u && p && document.activeElement !== btn) btn.click();
    }
  });
}
  // tombol reset login
  document.getElementById("btnReset").addEventListener("click", ()=>{
    if(confirm("Yakin ingin reset username & password ke default (admin/1234)?")){
      localStorage.setItem("settings", JSON.stringify({
        tema: "orange",
        judul: "E-SURAT DESA SANGEN",
        username: "admin",
        password: "1234"
      }));
      alert("âœ… Login berhasil direset ke admin / 1234");
      location.reload();
    }
  });


function renderMenu() {
  app.innerHTML = `
    <div style="padding:20px;">
      <h2 style="color:white;text-shadow:1px 1px 2px #000;">Menu Utama</h2>
      <div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;">
        <button class="menuBtn" onclick="renderSurat('masuk')">ğŸ“¥ Surat Masuk</button>
        <button class="menuBtn" onclick="renderSurat('keluar')">ğŸ“¤ Surat Keluar</button>
        <button class="menuBtn" onclick="renderArsip()">ğŸ—„ï¸ Arsip</button>
        <button class="menuBtn" onclick="renderPengaturan()">âš™ï¸ Pengaturan</button>
        <button class="menuBtn" onclick="logout()">ğŸšª Keluar</button>
      </div>
    </div>
  `;
  styleMenuButtons();
}

function styleMenuButtons() {
  const btns = document.querySelectorAll(".menuBtn");
  btns.forEach(btn=>{
    btn.style.background="#fff";
    btn.style.border="0";
    btn.style.borderRadius="8px";
    btn.style.padding="10px 20px";
    btn.style.cursor="pointer";
    btn.style.color="#ff8c00";
    btn.style.fontWeight="bold";
    btn.onmouseover=()=>btn.style.background="#ffe6c2";
    btn.onmouseout=()=>btn.style.background="#fff";
  });
}

function logout(){
  localStorage.removeItem("login_sangen");
  renderLogin();
}

// placeholder sementara untuk menu lain
function renderSurat(jenis){alert("Halaman surat "+jenis+" (Bagian 2 nanti)");}
function renderArsip(){alert("Halaman arsip (Bagian 3 nanti)");}
function renderPengaturan(){alert("Halaman pengaturan (Bagian 4 nanti)");}
// ---------------------------
// E-SURAT DESA SANGEN v2 â€“ Bagian 2
// Modul Surat Masuk & Keluar
// ---------------------------

function renderSurat(jenis){
  const daftar = jenis === "masuk" ? data.suratMasuk : data.suratKeluar;
  app.innerHTML = `
    <div style="padding:20px;">
      <h2 style="color:white;text-shadow:1px 1px 2px #000;">Surat ${jenis === "masuk" ? "Masuk" : "Keluar"}</h2>
      <button id="btnTambah" class="menuBtn">â• Tambah Surat</button>
      <button id="btnKembali" class="menuBtn">â¬…ï¸ Kembali</button>
      <table border="1" cellspacing="0" cellpadding="6" style="margin-top:10px;width:100%;background:white;border-radius:6px;">
        <thead style="background:#ff8c00;color:white;">
          <tr>
            <th>No</th>
            <th>Nomor Surat</th>
            <th>Tanggal</th>
            <th>Perihal</th>
            <th>Pengirim/Penerima</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="isiTabel"></tbody>
      </table>
    </div>
  `;
  styleMenuButtons();

  document.getElementById("btnKembali").onclick = renderMenu;
  document.getElementById("btnTambah").onclick = ()=>formSurat(jenis);
  isiTabelSurat(daftar, jenis);
}

function isiTabelSurat(list, jenis){
  const tb = document.getElementById("isiTabel");
  tb.innerHTML = list.length ? list.map((s,i)=>`
    <tr>
      <td>${i+1}</td>
      <td>${s.nomor}</td>
      <td>${s.tanggal}</td>
      <td>${s.perihal}</td>
      <td>${s.asalTujuan}</td>
      <td>
        <button onclick="hapusSurat('${jenis}',${i})" style="background:#ff4500;color:white;border:0;border-radius:4px;padding:4px 8px;">Hapus</button>
        <button onclick="arsipkanSurat('${jenis}',${i})" style="background:#32cd32;color:white;border:0;border-radius:4px;padding:4px 8px;">Arsip</button>
      </td>
    </tr>`).join("") : `<tr><td colspan="6" style="text-align:center;">Belum ada surat</td></tr>`;
}

function formSurat(jenis){
  app.innerHTML = `
    <div style="padding:20px;">
      <h2 style="color:white;">Tambah Surat ${jenis === "masuk" ? "Masuk" : "Keluar"}</h2>
      <div style="background:white;padding:15px;border-radius:8px;max-width:500px;">
        <label>Nomor Surat</label><br>
        <input id="fNomor" style="width:100%;margin-bottom:10px;"><br>
        <label>Tanggal</label><br>
        <input id="fTanggal" type="date" style="width:100%;margin-bottom:10px;"><br>
        <label>Perihal</label><br>
        <input id="fPerihal" style="width:100%;margin-bottom:10px;"><br>
        <label>${jenis==="masuk"?"Pengirim":"Penerima"}</label><br>
        <input id="fAsal" style="width:100%;margin-bottom:10px;"><br>
        <button id="btnSimpan" class="menuBtn">ğŸ’¾ Simpan</button>
        <button id="btnBatal" class="menuBtn">âŒ Batal</button>
      </div>
    </div>
  `;
  styleMenuButtons();

  document.getElementById("btnSimpan").onclick = ()=>{
    const s = {
      nomor: fNomor.value.trim(),
      tanggal: fTanggal.value,
      perihal: fPerihal.value.trim(),
      asalTujuan: fAsal.value.trim()
    };
    if(!s.nomor || !s.tanggal || !s.perihal || !s.asalTujuan){
      alert("Lengkapi semua data!");
      return;
    }
    if(jenis==="masuk") data.suratMasuk.push(s);
    else data.suratKeluar.push(s);
    simpanData();
    alert("Data tersimpan!");
    renderSurat(jenis);
  };

  document.getElementById("btnBatal").onclick = ()=>renderSurat(jenis);
}

function hapusSurat(jenis, idx){
  if(confirm("Yakin mau hapus surat ini?")){
    if(jenis==="masuk") data.suratMasuk.splice(idx,1);
    else data.suratKeluar.splice(idx,1);
    simpanData();
    renderSurat(jenis);
  }
}

function arsipkanSurat(jenis, idx){
  const surat = (jenis==="masuk"?data.suratMasuk:data.suratKeluar)[idx];
  surat.jenis = jenis;
  data.arsip.push(surat);
  hapusSurat(jenis, idx);
  simpanData();
  alert("Surat diarsipkan!");
}

function simpanData(){
  localStorage.setItem(LS_STATE, JSON.stringify(data));
}
// ---------------------------
// E-SURAT DESA SANGEN v2 â€“ Bagian 3
// Modul Arsip, Restore, Export Excel, Cetak
// ---------------------------

function renderArsip(){
  const arsip = data.arsip || [];
  app.innerHTML = `
    <div style="padding:20px;">
      <h2 style="color:white;text-shadow:1px 1px 2px #000;">Arsip Surat</h2>
      <button id="btnKembali" class="menuBtn">â¬…ï¸ Kembali</button>
      <button id="btnExport" class="menuBtn">ğŸ“¤ Export Excel</button>
      <table border="1" cellspacing="0" cellpadding="6" style="margin-top:10px;width:100%;background:white;border-radius:6px;">
        <thead style="background:#ff8c00;color:white;">
          <tr>
            <th>No</th>
            <th>Nomor Surat</th>
            <th>Tanggal</th>
            <th>Perihal</th>
            <th>Pengirim/Penerima</th>
            <th>Jenis</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="tabelArsip"></tbody>
      </table>
    </div>
  `;
  styleMenuButtons();
  document.getElementById("btnKembali").onclick = renderMenu;
  document.getElementById("btnExport").onclick = exportExcel;
  isiTabelArsip(arsip);
}

function isiTabelArsip(list){
  const tb = document.getElementById("tabelArsip");
  tb.innerHTML = list.length ? list.map((s,i)=>`
    <tr>
      <td>${i+1}</td>
      <td>${s.nomor}</td>
      <td>${s.tanggal}</td>
      <td>${s.perihal}</td>
      <td>${s.asalTujuan}</td>
      <td>${s.jenis}</td>
      <td>
        <button onclick="restoreSurat(${i})" style="background:#00b300;color:white;border:0;border-radius:4px;padding:4px 8px;">Restore</button>
        <button onclick="hapusArsip(${i})" style="background:#ff4500;color:white;border:0;border-radius:4px;padding:4px 8px;">Hapus</button>
      </td>
    </tr>`).join("") : `<tr><td colspan="7" style="text-align:center;">Belum ada arsip</td></tr>`;
}

function restoreSurat(i){
  const s = data.arsip[i];
  if(confirm("Kembalikan surat ke daftar "+s.jenis+"?")){
    if(s.jenis==="masuk") data.suratMasuk.push(s);
    else data.suratKeluar.push(s);
    data.arsip.splice(i,1);
    simpanData();
    renderArsip();
  }
}

function hapusArsip(i){
  if(confirm("Hapus arsip ini permanen?")){
    data.arsip.splice(i,1);
    simpanData();
    renderArsip();
  }
}
function exportExcel(){
  const wb = XLSX.utils.book_new();
  const ws_data = [
    ["Nomor Surat","Tanggal","Perihal","Pengirim/Penerima","Jenis"],
    ...data.arsip.map(s=>[s.nomor, s.tanggal, s.perihal, s.asalTujuan, s.jenis])
  ];
  const ws = XLSX.utils.aoa_to_sheet(ws_data);

  // Style header (opsional, warna oranye)
  const headerRange = XLSX.utils.decode_range(ws['!ref']);
  for(let C = headerRange.s.c; C <= headerRange.e.c; ++C){
    const cellAddress = XLSX.utils.encode_cell({r:0, c:C});
    if(!ws[cellAddress]) continue;
    ws[cellAddress].s = {
      fill: { fgColor: { rgb: "FFA500" } },
      font: { bold:true, color:{rgb:"FFFFFF"} },
      alignment: { horizontal: "center" }
    };
  }

  ws['!cols'] = [
    {wch:20},{wch:15},{wch:30},{wch:30},{wch:10}
  ];

  XLSX.utils.book_append_sheet(wb, ws, "Arsip Surat");
  XLSX.writeFile(wb, "Arsip_E-Surat_Desa_Sangen.xlsx");
}
// ---------------------------
// E-SURAT DESA SANGEN v2 â€“ Bagian 4
// Pengaturan + Animasi + Mode Publik
// ---------------------------

// animasi transisi antar halaman
function fadeTo(html) {
  app.style.opacity = 0;
  setTimeout(() => {
    app.innerHTML = html;
    app.style.opacity = 1;
  }, 200);
}

// render pengaturan
function renderPengaturan() {
  const settings = JSON.parse(localStorage.getItem("settings") || 
    '{"tema":"orange","judul":"E-SURAT DESA SANGEN","username":"admin","password":"1234"}');
  
  const app = document.getElementById("app");
  if (!app) return alert("Elemen utama tidak ditemukan!");

  app.innerHTML = `
    <div style="padding:20px;">
      <h2 style="color:white;text-shadow:1px 1px 2px #000;">âš™ï¸ Pengaturan Aplikasi</h2>

      <label style="color:white;">Judul Aplikasi:</label><br>
      <input id="judulInput" type="text" value="${settings.judul}" 
        style="padding:6px;width:60%;border-radius:5px;border:none;margin-bottom:10px;"><br>

      <label style="color:white;">Warna Tema:</label><br>
      <select id="temaSelect" style="padding:6px;width:60%;border-radius:5px;border:none;margin-bottom:20px;">
        <option value="orange" ${settings.tema==="orange"?"selected":""}>Oranye</option>
        <option value="blue" ${settings.tema==="blue"?"selected":""}>Biru</option>
      </select><br>

      <hr style="margin:20px 0;border-color:#fff3;">
      <label style="color:white;">Username Admin:</label><br>
      <input id="userInput" type="text" value="${settings.username}" 
        style="padding:6px;width:60%;border-radius:5px;border:none;margin-bottom:10px;"><br>

      <label style="color:white;">Password Admin:</label><br>
      <input id="passInput" type="password" value="${settings.password}" 
        style="padding:6px;width:60%;border-radius:5px;border:none;margin-bottom:20px;"><br>

      <button onclick="simpanPengaturan()" 
        style="padding:8px 20px;border:none;border-radius:8px;background:white;color:#333;font-weight:bold;">ğŸ’¾ Simpan</button>
      <button id="btnKembali" 
        style="padding:8px 20px;border:none;border-radius:8px;background:#e67e22;color:white;font-weight:bold;margin-left:10px;">ğŸ”™ Kembali</button>
    </div>
  `;

  document.getElementById("btnKembali").addEventListener("click", function(){
    renderMenu();
  });
}


function simpanPengaturan() {
  const judul = document.getElementById("judulInput").value;
  const tema = document.getElementById("temaSelect").value;
  const username = document.getElementById("userInput").value || "admin";
  const password = document.getElementById("passInput").value || "1234";

  localStorage.setItem("settings", JSON.stringify({judul, tema, username, password}));
  alert("âœ… Pengaturan disimpan!");
  location.reload();
}
function exportBackup() {
  const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "Backup_E-Surat_Desa_Sangen.json";
  link.click();
  alert("Data berhasil diekspor (backup JSON)");
}
// ---------------------------
// MODE PUBLIK FIX â€“ tombol kembali berfungsi
// ---------------------------

function renderPublik() {
  const dataMasuk = JSON.parse(localStorage.getItem("suratMasuk") || "[]");
  const dataKeluar = JSON.parse(localStorage.getItem("suratKeluar") || "[]");
  const semua = [
    ...dataMasuk.map(s => ({ ...s, jenis: "Masuk" })),
    ...dataKeluar.map(s => ({ ...s, jenis: "Keluar" }))
  ];

  const app = document.getElementById("app");
  app.innerHTML = `
    <div style="padding:20px;">
      <h2 style="color:white;text-shadow:1px 1px 2px #000;">ğŸ‘ï¸ Mode Publik â€“ Daftar Surat</h2>
      <table border="1" cellspacing="0" cellpadding="6" 
             style="width:100%;background:white;border-collapse:collapse;font-size:14px;">
        <thead style="background:#f39c12;color:white;">
          <tr>
            <th>No</th>
            <th>Nomor Surat</th>
            <th>Tanggal</th>
            <th>Perihal</th>
            <th>Pengirim/Penerima</th>
            <th>Jenis</th>
          </tr>
        </thead>
        <tbody>
          ${semua.map((s,i)=>`
            <tr>
              <td>${i+1}</td>
              <td>${s.nomor || "-"}</td>
              <td>${s.tanggal || "-"}</td>
              <td>${s.perihal || "-"}</td>
              <td>${s.asalTujuan || "-"}</td>
              <td>${s.jenis}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
      <div style="margin-top:20px;text-align:center;">
        <button id="btnKembaliPublik"
          style="padding:8px 20px;border:none;border-radius:8px;background:#e67e22;color:white;font-weight:bold;cursor:pointer;">
          ğŸ”™ Kembali
        </button>
      </div>
    </div>
  `;

  // Tombol kembali ke menu/login
  const btn = document.getElementById("btnKembaliPublik");
  if (btn) {
    btn.addEventListener("click", () => {
      if (localStorage.getItem("logged") === "true") {
        renderMenu();
      } else {
        renderLogin();
      }
    });
  }
}

  styleMenuButtons();

  // kasih waktu 200ms supaya tombol bener-bener sudah muncul
  setTimeout(()=>{
    const btn = document.getElementById("btnKembaliPublik");
    if(btn){
      btn.addEventListener("click", ()=>{
        // kalau admin login, balik ke menu utama
        if(sessionStorage.getItem("loggedIn")==="true"){
          renderMenu();
        } else {
          renderLogin();
        }
      });
    } else {
      alert("Tombol kembali tidak ditemukan!");
    }
  },200);



// ---------------------------
// Update menu utama: tambah Mode Publik & Pengaturan
// ---------------------------

const oldRenderMenu = renderMenu;
renderMenu = function() {
  app.innerHTML = `
    <div style="padding:20px;">
      <h2 style="color:white;text-shadow:1px 1px 2px #000;">Menu Utama</h2>
      <div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;">
        <button class="menuBtn" onclick="renderSurat('masuk')">ğŸ“¥ Surat Masuk</button>
        <button class="menuBtn" onclick="renderSurat('keluar')">ğŸ“¤ Surat Keluar</button>
        <button class="menuBtn" onclick="renderArsip()">ğŸ—„ï¸ Arsip</button>
        <button class="menuBtn" onclick="renderPublik()">ğŸ‘ï¸ Mode Publik</button>
        <button class="menuBtn" onclick="renderPengaturan()">âš™ï¸ Pengaturan</button>
        <button class="menuBtn" onclick="logout()">ğŸšª Keluar</button>
      </div>
    </div>
  `;
  styleMenuButtons();
};


</script>

</body>
</html>






